<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Googol Search</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<div class="container">

    <div th:if="${message}" th:class="'alert ' + (${msgType} == 'success' ? 'alert-success' : 'alert-error')" th:text="${message}"></div>

    <div class="header">
        <div class="tools-row">

            <div class="tool-box operations-panel">

                <div class="tool-section">
                    <span class="tool-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                        Indexar Nova Página
                    </span>
                    <form action="/index" method="post" class="input-group">
                        <input type="url" name="url" placeholder="Insira o URL completo (http://...)" required>
                        <button type="submit" class="btn btn-primary">Adicionar</button>
                    </form>
                </div>

                <div style="border-top: 1px solid var(--border-color); margin: 0 10px;"></div>

                <div class="tool-section">
                    <span class="tool-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
                        Verificar Links de Entrada
                    </span>
                    <form action="/links" method="get" class="input-group">
                        <input type="url" name="url" placeholder="Pesquisar URL alvo..." required>
                        <button type="submit" class="btn btn-secondary">Pesquisar</button>
                    </form>
                </div>

            </div>

            <div class="tool-box stats-box">
                <div class="stats-header-bar">
                    <span class="tool-title" style="margin:0; color: var(--text-primary);">
                        System Monitor
                    </span>
                    <span id="status-dot" class="status-dot" title="Estado da Conexão"></span>
                </div>
                <div id="stats-content" class="stats-content">
                    <div style="display:flex; justify-content:center; align-items:center; height:100%; color:var(--text-secondary);">
                        A conectar ao Gateway...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="search-section">
        <a href="/" class="logo">
            <span>G</span><span>o</span><span>o</span><span>g</span><span>o</span><span>l</span>
        </a>
        <form action="/" method="get" class="search-form">
            <input type="text" name="q" class="search-input" th:value="${query}" placeholder="Pesquise no Googol ou escreva um URL">
            <button type="submit" class="search-btn-icon" title="Pesquisar">
                <svg focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24px" height="24px" fill="currentColor">
                    <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
                </svg>
            </button>
        </form>
    </div>

    <div th:if="${aiSummary}" class="ai-summary-box">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
            <strong style="color: var(--accent-blue); font-size: 16px;">✨ Googol AI Overview</strong>
        </div>
        <p th:text="${aiSummary}" style="margin: 0; color: var(--text-primary); line-height: 1.7; font-size: 15px;"></p>
    </div>

    <div th:if="${results != null}">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div class="result-stats" th:text="'Resultados encontrados: ' + ${totalResults}"></div>
            <form action="/hacker-news/index" method="post">
                <input type="hidden" name="query" th:value="${query}">
                <button type="submit" class="btn" style="background-color: #ff6600; color: white; border-radius: 12px; font-size: 13px; padding: 8px 16px;">
                    Y Hacker News
                </button>
            </form>
        </div>

        <div th:if="${results.isEmpty()}" style="text-align:center; margin-top:50px; color: var(--text-secondary);">
            <p style="font-size: 18px;">Nenhum resultado encontrado para <strong><span th:text="${query}" style="color: var(--text-primary);"></span></strong>.</p>
        </div>

        <div th:each="entry : ${results}" class="result-card">
            <span class="result-url" th:text="${entry.key}">http://url.com</span>
            <a th:href="${entry.key}" class="result-title" th:text="${entry.value.title}">Sem Título</a>
            <div class="result-snippet" th:text="${entry.value.citation}">Descrição...</div>
            <a th:href="@{/links(url=${entry.key})}" class="btn-link" style="margin-top:5px; display:inline-block;">Ver links de entrada</a>
        </div>

        <div class="pagination" th:if="${totalPages > 1}">
            <a th:if="${currentPage > 1}" th:href="@{/(q=${query}, page=${currentPage - 1})}" class="page-btn">Anterior</a>
            <span style="font-size:14px; color:var(--text-secondary); align-self:center;" th:text="'Pág ' + ${currentPage}"></span>
            <a th:if="${currentPage < totalPages}" th:href="@{/(q=${query}, page=${currentPage + 1})}" class="page-btn">Seguinte</a>
        </div>
    </div>
</div>

<div class="snowflakes" aria-hidden="true">
  <div class="snowflake">❅</div>
  <div class="snowflake">❅</div>
  <div class="snowflake">❆</div>
  <div class="snowflake">❄</div>
  <div class="snowflake">❅</div>
  <div class="snowflake">❆</div>
  <div class="snowflake">❄</div>
  <div class="snowflake">❅</div>
  <div class="snowflake">❆</div>
  <div class="snowflake">❄</div>
</div>

<script type="text/javascript" th:src="@{/js/dashboard.js}"></script>

</body>
</html>